<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <!-- Ù†ÙØ³ Ù…Ø­ØªÙˆÙŠØ§Øª head Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© -->
</head>
<body>
    <!-- Ù†ÙØ³ Ù…Ø­ØªÙˆÙŠØ§Øª body Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© -->

    <!-- Ø£Ø¶Ù Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    
    <script src="js/data.js"></script>
    <script>
        class MainApp {
            constructor() {
                this.init();
            }
            
            async init() {
                console.log('ğŸš€ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ...');
                
                // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
                document.getElementById('currentYear').textContent = new Date().getFullYear();
                
                // Ø§Ù†ØªØ¸Ø§Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                await this.waitForData();
                
                // Ø¹Ø±Ø¶ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
                this.displaySections();
            }
            
            async waitForData() {
                // Ø§Ù†ØªØ¸Ø§Ø± Ù„Ù…Ø¯Ø© Ù‚ØµÙŠØ±Ø© Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                await new Promise(resolve => setTimeout(resolve, 1000));
            }
            
            displaySections() {
                const container = document.getElementById('sectionsContainer');
                
                // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† dataManager
                const sections = window.dataManager.getAllSections();
                const channels = window.dataManager.channels;
                
                if (sections.length === 0) {
                    container.innerHTML = `
                        <div class="loading">
                            <i class="uil uil-folder" style="font-size: 3rem; color: #b8b8b8;"></i>
                            <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ù‚Ø³Ø§Ù… Ù…ØªØ§Ø­Ø©</p>
                            <button onclick="location.reload()" class="btn btn-primary mt-3">
                                Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„
                            </button>
                        </div>
                    `;
                    return;
                }
                
                // Ø¥Ù†Ø´Ø§Ø¡ HTML Ù„Ù„Ø£Ù‚Ø³Ø§Ù…
                container.innerHTML = sections.map(section => {
                    const sectionChannels = channels.filter(ch => ch.sectionId === section.id);
                    const channelCount = sectionChannels.length;
                    const sectionLink = `section.html?id=${section.id}`;
                    
                    return `
                        <a href="${sectionLink}" target="_blank" class="section-card">
                            <div class="section-image">
                                <img src="${section.image}" 
                                     alt="${section.name}"
                                     onerror="this.src='https://i.postimg.cc/Bb0WFJfJ/Picsart-25-01-18-03-49-12-620.png'">
                            </div>
                            <div class="section-content">
                                <div class="section-name">${section.name}</div>
                                <div class="section-description">${section.description}</div>
                                <div class="section-footer">
                                    <div class="channel-count">
                                        ${channelCount} Ù‚Ù†Ø§Ø©
                                    </div>
                                    <div class="open-btn">
                                        <i class="uil uil-external-link-alt"></i>
                                        <span>ÙØªØ­ Ø§Ù„Ù‚Ø³Ù…</span>
                                    </div>
                                </div>
                            </div>
                        </a>
                    `;
                }).join('');
                
                console.log(`âœ… ØªÙ… Ø¹Ø±Ø¶ ${sections.length} Ù‚Ø³Ù…`);
            }
        }
        
        // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        document.addEventListener('DOMContentLoaded', () => {
            window.mainApp = new MainApp();
        });
    </script>
</body>
</html>
