<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <!-- Ù†ÙØ³ Ù…Ø­ØªÙˆÙŠØ§Øª head Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© -->
</head>
<body>
    <!-- Ù†ÙØ³ Ù…Ø­ØªÙˆÙŠØ§Øª body Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© -->

    <!-- Ø£Ø¶Ù Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    
    <script src="js/data.js"></script>
    <script>
        class SectionPage {
            constructor() {
                this.sectionId = null;
                this.section = null;
                this.channels = [];
                this.init();
            }
            
            async init() {
                console.log('ğŸš€ Ø¨Ø¯Ø¡ ØµÙØ­Ø© Ø§Ù„Ù‚Ø³Ù…...');
                
                // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
                document.getElementById('currentYear').textContent = new Date().getFullYear();
                
                // Ø§Ù†ØªØ¸Ø§Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                await this.waitForData();
                
                // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…Ø¹Ø±Ù Ø§Ù„Ù‚Ø³Ù…
                this.getSectionId();
                
                if (!this.sectionId) {
                    this.showError('Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù‚Ø³Ù…. Ø§Ù„Ø±Ø§Ø¨Ø· ØºÙŠØ± ØµØ­ÙŠØ­.');
                    return;
                }
                
                // ØªØ­Ù…ÙŠÙ„ ÙˆØ¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                this.loadAndDisplayData();
            }
            
            async waitForData() {
                // Ø§Ù†ØªØ¸Ø§Ø± Ù„Ù…Ø¯Ø© Ù‚ØµÙŠØ±Ø© Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                await new Promise(resolve => setTimeout(resolve, 1000));
            }
            
            getSectionId() {
                const urlParams = new URLSearchParams(window.location.search);
                this.sectionId = urlParams.get('id');
                console.log('ğŸ”— Ù…Ø¹Ø±Ù Ø§Ù„Ù‚Ø³Ù…:', this.sectionId);
            }
            
            loadAndDisplayData() {
                // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† dataManager
                this.section = window.dataManager.getSectionById(this.sectionId);
                this.channels = window.dataManager.getChannelsBySectionId(this.sectionId);
                
                if (!this.section) {
                    this.showError('Ø§Ù„Ù‚Ø³Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
                    return;
                }
                
                // Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                this.displayData();
            }
            
            displayData() {
                console.log(`ğŸ“º Ø¹Ø±Ø¶ ${this.channels.length} Ù‚Ù†Ø§Ø© Ù„Ù„Ù‚Ø³Ù…: ${this.section.name}`);
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„ÙˆØµÙ
                document.title = `${this.section.name} - Aseel TV`;
                document.getElementById('pageTitle').textContent = this.section.name;
                document.getElementById('sectionName').textContent = this.section.name;
                
                const description = this.section.description || 
                                  `Ø§Ø³ØªÙ…ØªØ¹ Ø¨Ù…Ø´Ø§Ù‡Ø¯Ø© ${this.channels.length} Ù‚Ù†Ø§Ø© Ù…ØªØ§Ø­Ø© ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù…`;
                document.getElementById('sectionDescription').textContent = description;
                
                // Ø¹Ø±Ø¶ Ø§Ù„Ù‚Ù†ÙˆØ§Øª
                this.displayChannels();
            }
            
            displayChannels() {
                const container = document.getElementById('channelsContainer');
                
                if (this.channels.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <i class="uil uil-tv-retro"></i>
                            <h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù‚Ù†ÙˆØ§Øª ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù…</h3>
                            <p>Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù‚Ù†ÙˆØ§Øª Ù‚Ø±ÙŠØ¨Ø§Ù‹</p>
                            <a href="index.html" class="back-button" style="display: inline-flex; margin-top: 20px;">
                                <i class="uil uil-arrow-left"></i> Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø£Ù‚Ø³Ø§Ù…
                            </a>
                        </div>
                    `;
                    return;
                }
                
                // Ø¥Ù†Ø´Ø§Ø¡ HTML Ù„Ù„Ù‚Ù†ÙˆØ§Øª
                container.innerHTML = this.channels.map(channel => `
                    <div class="channel-card" onclick="sectionPage.openChannel('${channel.id}')">
                        <div class="channel-logo">
                            <img src="${channel.image || 'https://i.postimg.cc/Bb0WFJfJ/Picsart-25-01-18-03-49-12-620.png'}" 
                                 alt="${channel.name}"
                                 onerror="this.src='https://i.postimg.cc/Bb0WFJfJ/Picsart-25-01-18-03-49-12-620.png'">
                        </div>
                        <div class="channel-name">${channel.name}</div>
                        <div class="channel-action">
                            <i class="uil uil-play-circle"></i>
                            <span>Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„Ù‚Ù†Ø§Ø©</span>
                        </div>
                    </div>
                `).join('');
            }
            
            openChannel(channelId) {
                const channel = this.channels.find(c => c.id === channelId);
                if (!channel) return;
                
                console.log('ğŸ”— ÙØªØ­ Ø§Ù„Ù‚Ù†Ø§Ø©:', channel.name);
                
                if (channel.url && channel.url !== '#') {
                    window.open(channel.url, '_blank');
                } else {
                    this.showDownloadPrompt(channel);
                }
            }
            
            showDownloadPrompt(channel) {
                if (confirm('Ù„Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„Ù‚Ù†Ø§Ø© ÙŠØ¬Ø¨ ØªØ«Ø¨ÙŠØª Ù…Ø´ØºÙ„ Ø§Ù„Ù‚Ù†ÙˆØ§Øª. Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¢Ù†ØŸ')) {
                    const downloadUrl = 'https://play.google.com/store/apps/details?id=com.xpola.player';
                    window.open(downloadUrl, '_blank');
                }
            }
            
            showError(message) {
                const container = document.getElementById('channelsContainer');
                container.innerHTML = `
                    <div class="error">
                        <i class="uil uil-exclamation-triangle" style="font-size: 4rem; margin-bottom: 20px;"></i>
                        <h3>${message}</h3>
                        <a href="index.html" class="back-button" style="display: inline-flex; margin-top: 20px;">
                            <i class="uil uil-arrow-left"></i> Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø£Ù‚Ø³Ø§Ù…
                        </a>
                    </div>
                `;
                
                document.getElementById('sectionName').textContent = 'Ø®Ø·Ø£';
                document.getElementById('sectionDescription').textContent = message;
            }
        }
        
        // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        document.addEventListener('DOMContentLoaded', () => {
            window.sectionPage = new SectionPage();
        });
    </script>
</body>
</html>
