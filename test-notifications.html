<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #1a1a1a;
            color: white;
        }
        
        .test-section {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
        }
        
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .btn-test {
            background: #4CAF50;
            color: white;
        }
        
        .btn-reset {
            background: #f44336;
            color: white;
        }
    </style>
</head>
<body>
    <h1>Ø§Ø®ØªØ¨Ø§Ø± Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</h1>
    
    <div class="test-section">
        <h3>1. ØªØ­Ù…ÙŠÙ„ Firebase</h3>
        <button onclick="loadFirebase()" class="btn-test">ØªØ­Ù…ÙŠÙ„ Firebase</button>
        <div id="firebaseStatus">Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø¨Ø¹Ø¯</div>
    </div>
    
    <div class="test-section">
        <h3>2. ÙØ­Øµ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h3>
        <button onclick="checkNotifications()" class="btn-test">ÙØ­Øµ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</button>
        <div id="notificationsStatus"></div>
    </div>
    
    <div class="test-section">
        <h3>3. Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± ØªØ¬Ø±ÙŠØ¨ÙŠ</h3>
        <button onclick="sendTestNotification()" class="btn-test">Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± ØªØ¬Ø±ÙŠØ¨ÙŠ</button>
        <div id="sendStatus"></div>
    </div>
    
    <div class="test-section">
        <h3>4. Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</h3>
        <button onclick="resetNotifications()" class="btn-reset">Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</button>
        <div id="resetStatus"></div>
    </div>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="js/firebase-config.js"></script>
    
    <script>
        async function loadFirebase() {
            try {
                document.getElementById('firebaseStatus').innerHTML = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...';
                await firebaseUtils.initializeFirebase();
                const db = firebaseUtils.getDB();
                document.getElementById('firebaseStatus').innerHTML = 'âœ… Firebase Ù…Ø­Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­';
                console.log('Firebase loaded:', db);
            } catch (error) {
                document.getElementById('firebaseStatus').innerHTML = 'âŒ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Firebase: ' + error.message;
            }
        }
        
        async function checkNotifications() {
            try {
                const db = firebaseUtils.getDB();
                const snapshot = await db.collection('notifications').get();
                
                let html = `<p>Ø¹Ø¯Ø¯ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª: ${snapshot.size}</p>`;
                
                snapshot.forEach(doc => {
                    const data = doc.data();
                    html += `
                        <div style="border:1px solid #ccc; padding:10px; margin:5px; background:#333;">
                            <strong>${data.title || 'Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†'}</strong><br>
                            ${data.message || 'Ø¨Ø¯ÙˆÙ† Ù†Øµ'}<br>
                            <small>ØªØ§Ø±ÙŠØ®: ${data.createdAt?.toDate?.().toLocaleString() || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</small><br>
                            <small>Ù†Ø´Ø·: ${data.isActive !== false ? 'Ù†Ø¹Ù…' : 'Ù„Ø§'}</small>
                        </div>
                    `;
                });
                
                document.getElementById('notificationsStatus').innerHTML = html;
            } catch (error) {
                document.getElementById('notificationsStatus').innerHTML = 'âŒ Ø®Ø·Ø£: ' + error.message;
            }
        }
        
        async function sendTestNotification() {
            try {
                const db = firebaseUtils.getDB();
                
                const testNotification = {
                    title: 'ğŸ”” Ø¥Ø´Ø¹Ø§Ø± ØªØ¬Ø±ÙŠØ¨ÙŠ',
                    message: 'Ù‡Ø°Ø§ Ø¥Ø´Ø¹Ø§Ø± ØªØ¬Ø±ÙŠØ¨ÙŠ Ù„Ø¥Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†Ø¸Ø§Ù…. ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ¸Ù‡Ø± ÙÙŠ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©.',
                    createdAt: new Date(),
                    isActive: true,
                    duration: 3,
                    sentBy: 'Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±'
                };
                
                await db.collection('notifications').add(testNotification);
                document.getElementById('sendStatus').innerHTML = 'âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ Ø¨Ù†Ø¬Ø§Ø­';
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø¹Ø¯ 2 Ø«Ø§Ù†ÙŠØ©
                setTimeout(checkNotifications, 2000);
                
            } catch (error) {
                document.getElementById('sendStatus').innerHTML = 'âŒ Ø®Ø·Ø£: ' + error.message;
            }
        }
        
        function resetNotifications() {
            localStorage.removeItem('bein_notifications');
            localStorage.removeItem('read_notifications');
            localStorage.removeItem('last_notification_check');
            localStorage.removeItem('last_popup_time');
            
            document.getElementById('resetStatus').innerHTML = 'âœ… ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©';
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ø¨Ø¹Ø¯ Ø«Ø§Ù†ÙŠØªÙŠÙ†
            setTimeout(() => {
                location.reload();
            }, 2000);
        }
        
        // ØªØ­Ù…ÙŠÙ„ Firebase ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
        setTimeout(loadFirebase, 1000);
    </script>
</body>
</html>
